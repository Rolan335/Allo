<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чат</title>
</head>

<body>
    <h1 class="title">Алло</h1>
    <h3 class="username"></h3>
    <form action="" id="regForm">
        Введите имя:
        <input type="text" name="name" id="name">
        <input type="submit" name="submitName" id="submitName">
    </form>
    <form id="messageForm" action="">
        Введите сообщение:
        <input type="text" name="message" id="message">
        <input type="submit" name="submitMessage" id="submitMessage">
    </form>
    <div class="activeUsers">
        <p>В сети:</p>
    </div>
    <div class="messageBox">
        <p>Сообщения:</p>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io.connect()
        const regForm = document.querySelector("#regForm")
        const activeUsers = document.querySelector(".activeUsers")
        const messageForm = document.querySelector("#messageForm")
        const messageBox = document.querySelector(".messageBox")
        const usernameBox = document.querySelector(".username")


        messageForm.addEventListener("submit", function (e) {
            e.preventDefault()
            const message = document.querySelector("#message").value
            socket.emit('send message', message)
        })

        regForm.addEventListener("submit", function (e) {
            e.preventDefault()
            const name = document.querySelector("#name").value
            socket.emit("new user", name)
            usernameBox.innerHTML += `С подключением, ${name}.`
            regForm.style.display = "none"
        })

        socket.on('add user', function (username) {
            activeUsers.innerHTML += `<a>${username.username}</a><br>`
        })

        socket.on('load history', function (history) {
            for (let i = 0; i < history.length; i++) {
                messageBox.innerHTML += `<div>${history[i].author} пишет: ${history[i].msg}</div>`
            }
        })

        socket.on('load users', function (users) {
            for (let i = 0; i < users.length; i++) {
                activeUsers.innerHTML += `<a>${users[i].username}</a><br>`
            }
        })

        socket.on('update users', function (users) {
            activeUsers.innerHTML = '<p>В сети:</p>'
            for (let i = 0; i < users.length; i++) {
                activeUsers.innerHTML += `<a>${users[i].username}</a><br>`
            }
        })

        socket.on('add message', function (data) {
            messageBox.innerHTML += `<div>${data.author} пишет: ${data.msg}</div>`
        })
    </script>
</body>

</html>

<!--Страница регистрации - автоматически регистрируется id.-->